<div class="hojas-vida-container">
  <!-- Encabezado -->
  <div class="header">
    <h1>Hojas de Vida de Equipos</h1>
    <p class="subtitle">Gestión y consulta de hojas de vida de equipos de sistemas</p>
  </div>

  <!-- Barra de herramientas -->
  <div class="toolbar">
    <div class="search-box">
      <input
        type="text"
        placeholder="Buscar por equipo, IP, MAC, procesador, usuario..."
        (input)="onSearch($event)"
        class="search-input"
      />
    </div>
    <div class="toolbar-info">
      <span class="count">Total: {{ filteredHojasVida.length }} hojas de vida</span>
    </div>
  </div>

  <!-- Indicador de carga -->
  <div *ngIf="isLoading" class="loading">
    <div class="spinner"></div>
    <p>Cargando hojas de vida...</p>
  </div>

  <!-- Mensaje de error -->
  <div *ngIf="error" class="error-message">
    <p>{{ error }}</p>
    <button (click)="loadHojasVida()" class="retry-button">Reintentar</button>
  </div>

  <!-- Tabla de hojas de vida -->
  <div *ngIf="!isLoading && !error" class="table-container">
    <table class="hojas-vida-table">
      <thead>
        <tr>
          <th>Equipo</th>
          <th>Usuario</th>
          <th>IP / MAC</th>
          <th>Hardware</th>
          <th>Software</th>
          <th>Ubicación</th>
          <th>Fecha Instalación</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let hojaVida of filteredHojasVida" class="table-row">
          <td>
            <div class="equipo-info">
              <strong>{{ hojaVida.equipo?.nombre_equipo || 'N/A' }}</strong>
              <small>{{ hojaVida.equipo?.marca }} {{ hojaVida.equipo?.modelo }}</small>
            </div>
          </td>
          <td>{{ hojaVida.nombre_usuario || 'N/A' }}</td>
          <td>
            <div class="network-info">
              <span class="ip">{{ hojaVida.ip || 'N/A' }}</span>
              <small class="mac">{{ hojaVida.mac || 'N/A' }}</small>
            </div>
          </td>
          <td>
            <div class="hardware-info">
              <span>{{ hojaVida.procesador || 'N/A' }}</span>
              <small>{{ hojaVida.ram || 'N/A' }} | {{ hojaVida.disco_duro || 'N/A' }}</small>
            </div>
          </td>
          <td>
            <div class="software-info">
              <span>{{ hojaVida.sistema_operativo || 'N/A' }}</span>
              <small>{{ hojaVida.office || 'N/A' }}</small>
            </div>
          </td>
          <td>
            <div class="ubicacion-info">
              <span>{{ hojaVida.equipo?.servicio?.nombres || 'N/A' }}</span>
              <small>{{ hojaVida.equipo?.servicio?.ubicacion || '' }}</small>
            </div>
          </td>
          <td>{{ formatDate(hojaVida.fecha_instalacion) }}</td>
          <td>
            <div class="action-buttons">
              <button
                (click)="viewDetail(hojaVida)"
                class="action-button view-button"
                title="Ver detalles"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
              </button>
              <button
                (click)="openEditModal(hojaVida)"
                class="action-button edit-button"
                title="Editar hoja de vida"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="filteredHojasVida.length === 0">
          <td colspan="8" class="no-data">
            No se encontraron hojas de vida
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal de detalle -->
  <div *ngIf="isDetailModalOpen" class="modal-overlay" (click)="closeDetailModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Detalle de Hoja de Vida</h2>
        <button (click)="closeDetailModal()" class="close-button">&times;</button>
      </div>
      <div class="modal-body" *ngIf="selectedHojaVida">
        <!-- Información del Equipo -->
        <div class="detail-section">
          <h3>Información del Equipo</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Nombre:</label>
              <span>{{ selectedHojaVida.equipo?.nombre_equipo || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Marca:</label>
              <span>{{ selectedHojaVida.equipo?.marca || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Modelo:</label>
              <span>{{ selectedHojaVida.equipo?.modelo || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Serie:</label>
              <span>{{ selectedHojaVida.equipo?.serie || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Placa:</label>
              <span>{{ selectedHojaVida.equipo?.placa_inventario || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Tipo:</label>
              <span>{{ selectedHojaVida.equipo?.tipoEquipo?.nombres || 'N/A' }}</span>
            </div>
          </div>
        </div>

        <!-- Configuración de Red -->
        <div class="detail-section">
          <h3>Configuración de Red</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Dirección IP:</label>
              <span>{{ selectedHojaVida.ip || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Dirección MAC:</label>
              <span>{{ selectedHojaVida.mac || 'N/A' }}</span>
            </div>
          </div>
        </div>

        <!-- Especificaciones Técnicas -->
        <div class="detail-section">
          <h3>Especificaciones Técnicas</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Procesador:</label>
              <span>{{ selectedHojaVida.procesador || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Memoria RAM:</label>
              <span>{{ selectedHojaVida.ram || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Disco Duro:</label>
              <span>{{ selectedHojaVida.disco_duro || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Sistema Operativo:</label>
              <span>{{ selectedHojaVida.sistema_operativo || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Office:</label>
              <span>{{ selectedHojaVida.office || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Tóner:</label>
              <span>{{ selectedHojaVida.tonner || 'N/A' }}</span>
            </div>
          </div>
        </div>

        <!-- Información de Usuario -->
        <div class="detail-section">
          <h3>Información de Usuario y Adquisición</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Usuario:</label>
              <span>{{ selectedHojaVida.nombre_usuario || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Tipo de Uso:</label>
              <span>{{ selectedHojaVida.tipo_uso || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Vendedor:</label>
              <span>{{ selectedHojaVida.vendedor || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Contrato:</label>
              <span>{{ selectedHojaVida.contrato || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Fecha de Compra:</label>
              <span>{{ formatDate(selectedHojaVida.fecha_compra) }}</span>
            </div>
            <div class="detail-item">
              <label>Fecha de Instalación:</label>
              <span>{{ formatDate(selectedHojaVida.fecha_instalacion) }}</span>
            </div>
            <div class="detail-item">
              <label>Costo de Compra:</label>
              <span>{{ formatCurrency(selectedHojaVida.costo_compra) }}</span>
            </div>
          </div>
        </div>

        <!-- Tipo de Adquisición -->
        <div class="detail-section">
          <h3>Tipo de Adquisición</h3>
          <div class="detail-tags">
            <span *ngIf="selectedHojaVida.compraddirecta" class="tag tag-success">Compra Directa</span>
            <span *ngIf="selectedHojaVida.convenio" class="tag tag-info">Convenio</span>
            <span *ngIf="selectedHojaVida.donado" class="tag tag-warning">Donado</span>
            <span *ngIf="selectedHojaVida.comodato" class="tag tag-secondary">Comodato</span>
            <span *ngIf="!selectedHojaVida.compraddirecta && !selectedHojaVida.convenio && !selectedHojaVida.donado && !selectedHojaVida.comodato" class="tag">N/A</span>
          </div>
        </div>

        <!-- Observaciones -->
        <div class="detail-section" *ngIf="selectedHojaVida.observaciones">
          <h3>Observaciones</h3>
          <p class="observaciones">{{ selectedHojaVida.observaciones }}</p>
        </div>
      </div>
      <div class="modal-footer">
        <button (click)="closeDetailModal()" class="button button-secondary">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Modal de edición -->
  <app-hoja-vida-edit-modal
    [isOpen]="isEditModalOpen"
    [hojaVida]="hojaVidaToEdit"
    (closed)="closeEditModal()"
    (saved)="onHojaVidaSaved()"
  ></app-hoja-vida-edit-modal>
</div>
