@if (isOpen && equipo) {
  <div class="modal-overlay" (click)="close()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <!-- Header -->
      <div class="modal-header">
        <div class="header-content">
          <h2>{{ equipo.nombre_equipo }}</h2>
          <span [class]="getEstadoBadgeClass(equipo.activo)">
            {{ formatEstado(equipo.activo) }}
          </span>
        </div>
        <button class="btn-close" (click)="close()" type="button">‚úï</button>
      </div>

      <!-- Body -->
      <div class="modal-body">
        <!-- Informaci√≥n B√°sica -->
        <div class="detail-section">
          <h3 class="section-title">Informaci√≥n B√°sica</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">ID</span>
              <span class="detail-value">{{ equipo.id_sysequipo }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Marca</span>
              <span class="detail-value">{{ formatValue(equipo.marca) }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Modelo</span>
              <span class="detail-value">{{ formatValue(equipo.modelo) }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">N√∫mero de Serie</span>
              <span class="detail-value">
                <code class="serie-badge">{{ formatValue(equipo.serie) }}</code>
              </span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Placa de Inventario</span>
              <span class="detail-value">{{ formatValue(equipo.placa_inventario) }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">C√≥digo</span>
              <span class="detail-value">{{ formatValue(equipo.codigo) }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Ubicaci√≥n</span>
              <span class="detail-value">üìç {{ formatValue(equipo.ubicacion) }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Ubicaci√≥n Espec√≠fica</span>
              <span class="detail-value">{{ formatValue(equipo.ubicacion_especifica) }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">A√±o de Ingreso</span>
              <span class="detail-value">{{ equipo.ano_ingreso || 'No especificado' }}</span>
            </div>
          </div>
        </div>

        <!-- Mantenimiento -->
        <div class="detail-section">
          <h3 class="section-title">Informaci√≥n de Mantenimiento</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">Requiere Mantenimiento</span>
              <span class="detail-value">{{ equipo.mtto === 1 ? 'S√≠' : 'No' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">D√≠as de Mantenimiento</span>
              <span class="detail-value">{{ equipo.dias_mantenimiento || 'No especificado' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Periodicidad (d√≠as)</span>
              <span class="detail-value">{{ equipo.periodicidad || 'No especificado' }}</span>
            </div>
          </div>
        </div>

        <!-- Configuraci√≥n de Red -->
        <div class="detail-section">
          <h3 class="section-title">Configuraci√≥n de Red</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">Administrable</span>
              <span class="detail-value">{{ equipo.administrable === 1 ? 'S√≠' : 'No' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">N√∫mero de Puertos</span>
              <span class="detail-value">{{ equipo.numero_puertos || 'No especificado' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Direccionamiento VLAN</span>
              <span class="detail-value">
                @if (equipo.direccionamiento_Vlan) {
                  <code class="ip-badge">{{ equipo.direccionamiento_Vlan }}</code>
                } @else {
                  <span>No especificado</span>
                }
              </span>
            </div>
          </div>
        </div>

        <!-- Historial de Mantenimientos -->
        <div class="detail-section historial-section">
          <div class="section-header-with-toggle">
            <h3 class="section-title">Historial de Mantenimientos</h3>
            <button class="btn-toggle" (click)="toggleHistorial()" type="button">
              {{ showHistorial ? '‚ñº' : '‚ñ∂' }}
            </button>
          </div>

          @if (showHistorial) {
            @if (isLoadingMantenimientos) {
              <div class="loading-historial">
                <span class="spinner">‚è≥</span>
                <span>Cargando historial...</span>
              </div>
            } @else if (mantenimientos.length > 0) {
              <div class="historial-list">
                @for (mant of mantenimientos; track mant.id_sysmtto) {
                  <div class="historial-item">
                    <div class="historial-header">
                      <div class="historial-title">
                        <strong>{{ mant.numero_reporte || 'Sin n√∫mero' }}</strong>
                        <span [class]="getTipoMantenimientoBadgeClass(mant.tipo_mantenimiento)">
                          {{ mant.tipo_mantenimiento || 'N/A' }}
                        </span>
                        <span [class]="getEstadoMantenimientoBadgeClass(mant.estado)">
                          {{ formatEstadoMantenimiento(mant.estado) }}
                        </span>
                      </div>
                      <span class="historial-date">{{ formatDate(mant.fecha) }}</span>
                    </div>
                    @if (mant.tipo_falla) {
                      <div class="historial-detail">
                        <strong>Falla:</strong> {{ mant.tipo_falla }}
                      </div>
                    }
                    @if (mant.descripcion_falla) {
                      <div class="historial-detail">
                        <strong>Descripci√≥n:</strong> {{ mant.descripcion_falla }}
                      </div>
                    }
                    @if (mant.observaciones) {
                      <div class="historial-detail">
                        <strong>Observaciones:</strong> {{ mant.observaciones }}
                      </div>
                    }
                    @if (mant.nombre_tecnico) {
                      <div class="historial-detail">
                        <strong>T√©cnico:</strong> üë§ {{ mant.nombre_tecnico }}
                      </div>
                    }
                  </div>
                }
              </div>
            } @else {
              <div class="empty-historial">
                <span class="empty-icon">üìã</span>
                <p>No hay mantenimientos registrados para este equipo</p>
              </div>
            }
          }
        </div>
      </div>

      <!-- Footer -->
      <div class="modal-footer no-print">
        <button class="btn btn-secondary" (click)="close()" type="button">
          Cerrar
        </button>
        <button class="btn btn-secondary" (click)="printToPDF()" type="button">
          <span>üñ®Ô∏è</span>
          <span>Imprimir / PDF</span>
        </button>
        <button class="btn btn-primary" (click)="requestEdit()" type="button">
          <span>‚úèÔ∏è</span>
          <span>Editar Equipo</span>
        </button>
      </div>
    </div>
  </div>
}
