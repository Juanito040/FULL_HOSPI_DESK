<nav class="navbar">
  <div class="nav-container">
    <!-- Logo y título -->
    <a [routerLink]="['/dashboard']" class="nav-brand">
      <img src="img/logo-husrt-1024x320.png" alt="Hospital San Rafael" class="logo">
      <span class="brand-name"></span>
    </a>

    <!-- Menú de navegación (desktop) -->
    <ul class="nav-menu" [class.active]="isMenuOpen">
      @for (item of menuItems; track item.label) {
        @if (canShowMenuItem(item)) {
          <li class="nav-item" [class.has-submenu]="item.submenu">
            <!-- Item sin submenú -->
            @if (!item.submenu) {
              <a
                [routerLink]="item.path"
                routerLinkActive="active"
                class="nav-link"
                (click)="closeMenu()">
                <span class="nav-icon">{{ item.icon }}</span>
                <span class="nav-label">{{ item.label }}</span>
              </a>
            }

          <!-- Item con submenú -->
          @if (item.submenu) {
            <a
              class="nav-link has-dropdown"
              [class.open]="item.isOpen"
              (click)="toggleSubmenu(item)">
              <span class="nav-icon">{{ item.icon }}</span>
              <span class="nav-label">{{ item.label }}</span>
              <span class="dropdown-arrow">{{ item.isOpen ? '▼' : '▶' }}</span>
            </a>

            <!-- Submenú -->
            <ul class="submenu" [class.open]="item.isOpen">
              @for (subitem of item.submenu; track subitem.path) {
                <li class="submenu-item">
                  <a
                    [routerLink]="subitem.path"
                    routerLinkActive="active"
                    class="submenu-link"
                    (click)="closeMenu()">
                    @if (subitem.icon) {
                      <span class="submenu-icon">{{ subitem.icon }}</span>
                    }
                    <span class="submenu-label">{{ subitem.label }}</span>
                  </a>
                </li>
              }
            </ul>
          }
          </li>
        }
      }
    </ul>

    <!-- Menú de usuario -->
    @if (currentUser) {
      <div class="user-menu-container" >
        <button class="user-menu-button" (click)="toggleUserMenu()">
          <div class="user-avatar">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          </div>
          <div class="user-info">
            <span class="user-name">{{ currentUser.nombres }}</span>
          </div>
          <svg class="dropdown-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>

        @if (showUserMenu) {
          <div class="user-dropdown">
            <div class="user-dropdown-header">
              <p class="user-dropdown-name">{{ currentUser.nombres }} {{ currentUser.apellidos }}</p>
              <p class="user-dropdown-email">{{ currentUser.email }}</p>
            </div>
            <div class="user-dropdown-divider"></div>
            <button class="user-dropdown-item logout-button" (click)="logout()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
              </svg>
              Cerrar Sesión
            </button>
          </div>
        }
      </div>
    }

    <!-- Botón hamburguesa (mobile) -->
    <button
      class="hamburger"
      [class.active]="isMenuOpen"
      (click)="toggleMenu()"
      aria-label="Toggle menu">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>
</nav>
